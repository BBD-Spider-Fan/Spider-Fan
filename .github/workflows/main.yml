name: Deploy spider fan

on:
  push:

jobs:
  deploy_api:
    runs-on: self-hosted
    steps:
      - name: checkout
        uses: actions/checkout@v4
      - name: run
        env:
          PORT: ${{secrets.PORT}}
        run: |
          curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash
          . ~/.nvm/nvm.sh
          npm install
          lsof -ti:80 | xargs -r sudo kill -9
          sudo -E $(which node) ./bin/www
